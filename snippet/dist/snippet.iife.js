!function(){"use strict";class e{constructor(e){this.customerId=null,this.cartToken=null,this.config=e,this.sessionId=this.generateSessionId(),this.init()}init(){this.loadToken(),this.detectCustomer(),this.trackPageView(),this.setupEventListeners(),this.setupCartTracking(),this.setupCustomerSync(),this.setupCheckoutAutofill()}detectCustomer(){var e,t,o;(null==(o=null==(t=null==(e=window.ShopifyAnalytics)?void 0:e.meta)?void 0:t.page)?void 0:o.customerId)&&(this.customerId=window.ShopifyAnalytics.meta.page.customerId,this.syncCustomerToEagle())}async syncCustomerToEagle(){if(this.customerId)try{await fetch(`${this.config.apiUrl}/api/v1/events/collect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:this.config.shop,sessionId:this.sessionId,eagleToken:this.config.token,shopifyCustomerId:this.customerId,eventType:"customer_session",payload:{timestamp:(new Date).toISOString()}})})}catch(e){}}setupCartTracking(){if("undefined"!=typeof window){const e=window.fetch;window.fetch=async(...t)=>{var o;const i=await e(...t),n=(null==(o=t[0])?void 0:o.toString())||"";return(n.includes("/cart/")||n.includes("/cart.js"))&&this.syncCartToEagle(),i},this.syncCartToEagle(),setInterval(()=>this.syncCartToEagle(),3e4)}}async syncCartToEagle(){try{const e=await fetch("/cart.js"),t=await e.json();this.cartToken=t.token,await fetch(`${this.config.apiUrl}/api/v1/events/collect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:this.config.shop,sessionId:this.sessionId,eagleToken:this.config.token,shopifyCustomerId:this.customerId,eventType:"cart_update",payload:{cartToken:this.cartToken,items:t.items,itemCount:t.item_count,totalPrice:t.total_price,currency:t.currency}})})}catch(e){}}setupCustomerSync(){const e=()=>{var e,t;(null==(e=window.Shopify)?void 0:e.customer)&&(this.customerId=null==(t=window.Shopify.customer.id)?void 0:t.toString(),this.config.token&&this.linkCustomerAccounts())};e(),setInterval(e,5e3)}async linkCustomerAccounts(){if(this.customerId&&this.config.token)try{await fetch(`${this.config.apiUrl}/api/v1/events/collect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:this.config.shop,sessionId:this.sessionId,eagleToken:this.config.token,shopifyCustomerId:this.customerId,eventType:"customer_link",payload:{timestamp:(new Date).toISOString(),action:"link_accounts"}})})}catch(e){}}generateSessionId(){return`eagle-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}loadToken(){const e=localStorage.getItem("eagle_token");e&&(this.config.token=e)}async trackEvent(e,t){try{await fetch(`${this.config.apiUrl}/api/v1/events/collect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:this.config.shop,sessionId:this.sessionId,eagleToken:this.config.token,eventType:e,payload:t,timestamp:(new Date).toISOString()})})}catch(o){}}trackPageView(){this.trackEvent("page_view",{url:window.location.href,path:window.location.pathname,referrer:document.referrer})}setupEventListeners(){window.location.pathname.includes("/products/")&&this.trackProductView(),document.addEventListener("click",e=>{const t=e.target;(t.closest('[name="add"]')||t.closest(".product-form__submit"))&&this.trackAddToCart()})}trackProductView(){const e=document.querySelector('meta[property="og:product_id"]');if(e){const t=e.getAttribute("content");this.trackEvent("product_view",{productId:t,url:window.location.href})}}trackAddToCart(){this.trackEvent("add_to_cart",{url:window.location.href})}setToken(e){this.config.token=e,localStorage.setItem("eagle_token",e)}clearToken(){this.config.token=void 0,localStorage.removeItem("eagle_token")}setupCheckoutAutofill(){if(!window.location.href.includes("/checkout")&&!window.location.href.includes("/checkouts"))return;const e=()=>{try{const e=localStorage.getItem("eagle_checkout_autofill")||sessionStorage.getItem("eagle_checkout_autofill");if(!e)return!1;const t=JSON.parse(e);if(Date.now()-t.timestamp>3e5)return localStorage.removeItem("eagle_checkout_autofill"),sessionStorage.removeItem("eagle_checkout_autofill"),!1;let o=0;const i=(e,t)=>{const i=document.querySelector(e);return!(!i||!t||i.value)&&(i.value=t,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),o++,!0)},n=(e,t)=>{const i=document.querySelector(e);if(i&&t){const e=Array.from(i.options).find(e=>{var o,i;return e.value===t||(null==(o=e.textContent)?void 0:o.trim())===t||(null==(i=e.textContent)?void 0:i.includes(t))});if(e&&i.value!==e.value)return i.value=e.value,i.dispatchEvent(new Event("change",{bubbles:!0})),o++,!0}return!1};return i("#email",t.email),i('input[name="email"]',t.email),i('input[autocomplete="shipping email"]',t.email),i('input[autocomplete="email"]',t.email),i("#TextField3225",t.firstName),i('input[name="firstName"]',t.firstName),i('input[autocomplete="shipping given-name"]',t.firstName),i('input[autocomplete="given-name"]',t.firstName),i("#TextField3226",t.lastName),i('input[name="lastName"]',t.lastName),i('input[autocomplete="shipping family-name"]',t.lastName),i('input[autocomplete="family-name"]',t.lastName),i("#shipping-address1",t.address1),i('input[name="address1"]',t.address1),i('input[autocomplete="shipping address-line1"]',t.address1),i('input[autocomplete="address-line1"]',t.address1),t.address2&&(i("#TextField3227",t.address2),i('input[name="address2"]',t.address2),i('input[autocomplete="shipping address-line2"]',t.address2),i('input[autocomplete="address-line2"]',t.address2)),i("#TextField3228",t.city),i('input[name="city"]',t.city),i('input[autocomplete="shipping address-level2"]',t.city),i('input[autocomplete="address-level2"]',t.city),n("#Select613",t.state),n('select[name="zone"]',t.state),n('select[autocomplete="shipping address-level1"]',t.state),n('select[autocomplete="address-level1"]',t.state),i("#TextField3229",t.zip),i('input[name="postalCode"]',t.zip),i('input[autocomplete="shipping postal-code"]',t.zip),i('input[autocomplete="postal-code"]',t.zip),t.country&&(n("#Select612",t.country),n('select[name="countryCode"]',t.country),n('select[autocomplete="shipping country-name"]',t.country),n('select[autocomplete="country"]',t.country)),o>0&&setTimeout(()=>{localStorage.removeItem("eagle_checkout_autofill"),sessionStorage.removeItem("eagle_checkout_autofill")},1e4),o>0}catch(e){return!1}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{setTimeout(e,500),setTimeout(e,2e3),setTimeout(e,5e3)}):(e(),setTimeout(e,500),setTimeout(e,2e3),setTimeout(e,5e3));const t=new MutationObserver(()=>{e()});t.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{t.disconnect()},3e4)}}!function(){const t=document.currentScript,o=(null==t?void 0:t.getAttribute("data-api-url"))||"https://api.eagledtfsupply.com",i=(null==t?void 0:t.getAttribute("data-shop"))||"";"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.Eagle=new e({apiUrl:o,shop:i})}):window.Eagle=new e({apiUrl:o,shop:i})}()}();
